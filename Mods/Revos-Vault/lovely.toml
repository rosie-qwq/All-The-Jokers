[manifest]
version = "1.0.0"
dump_lua = true
priority = 99999


[[patches]]
[patches.pattern]
target = "game.lua"
pattern = "local replace_card = Card(self.title_top.T.x, self.title_top.T.y, 1.2*G.CARD_W*SC_scale, 1.2*G.CARD_H*SC_scale, G.P_CARDS.S_A, G.P_CENTERS.c_base)"
position = "at"
payload = '''
if next(SMODS.find_mod("Cryptid")) then
    replace_card = Card(self.title_top.T.x, self.title_top.T.y, 1.2*G.CARD_W*SC_scale, 1.2*G.CARD_H*SC_scale, G.P_CARDS.S_A, G.P_CENTERS.c_base)
else
	replace_card = SMODS.create_card({
		set = "Joker",
		area = G.title_top,
		key = "j_crv_printertitle",
		no_edition = true
	})
    replace_card.T.scale = 1.32
end
'''
match_indent = true
overwrite = true

[[patches]]
[patches.pattern]
target = "game.lua"
pattern = "SC = Card(G.ROOM.T.w/2 - SC_scale*G.CARD_W/2, 10. + G.ROOM.T.h/2 - SC_scale*G.CARD_H/2, SC_scale*G.CARD_W, SC_scale*G.CARD_H, G.P_CARDS.empty, G.P_CENTERS['j_joker'])"
position = "after"
payload = '''
	SC = Card(G.ROOM.T.w/2 - SC_scale*G.CARD_W/2, 10. + G.ROOM.T.h/2 - SC_scale*G.CARD_H/2, SC_scale*G.CARD_W, SC_scale*G.CARD_H, G.P_CARDS.empty, G.P_CENTERS['j_crv_holybanana'],{bypass_discovery_center = true, bypass_discovery_ui = true})
'''
match_indent = true

[[patches]]
[patches.pattern]
target = "game.lua"
pattern = '''
"m_glass =   {max = 500, order = 5, name = "Glass Card", set = "Enhanced", pos = {x=5,y=1}, effect = "Glass Card", label = "Glass Card", config = {Xmult = 2, extra = 4}},"
'''
position = "at"
payload = '''
m_glass =   {max = 500, order = 5, name = "Glass Card", set = "Enhanced", pos = {x=5,y=1}, effect = "Glass Card", label = "Glass Card", config = {Xmult = 2, extra = G.GAME.glassodds}},
'''
match_indent = true
overwrite = true

[[patches]]
[patches.pattern]
target = "commen_events.lua"
pattern = '''
"elseif _c.effect == 'Glass Card' then loc_vars = {_c.config.Xmult, G.GAME.probabilities.normal, _c.config.extra}"
'''
position = "at"
payload = '''
elseif _c.effect == 'Glass Card' then loc_vars = {_c.config.Xmult, G.GAME.probabilities.normal, G.GAME.glassodds}
'''
match_indent = true
overwrite = true


# Trying to patch into obsidian orb to fix bricking issue

[[patches]]
[patches.pattern]
target = '=[SMODS Cryptid "lib/overrides.lua"]'
pattern = '		(self.name ~= "cry-oldarm" or not G.GAME.defeated_blinds["bl_psychic"])'
position = "after"
payload = '''
		and (self.name ~= "The Psychic" or not G.GAME.defeated_blinds["bl_crv_minimalizm"])
'''
match_indent = true


[[patches]]
[patches.pattern]
target = "game.lua"
pattern = "{card_limit = self.GAME.starting_params.joker_slots, type = 'joker', highlight_limit = 1})"
position = "at"
payload = "{card_limit = self.GAME.starting_params.joker_slots, type = 'joker', highlight_limit = 2})"
match_indent = true



# Gems Tab
[[patches]]
[patches.pattern]
target = 'functions/UI_definitions.lua'
pattern = "G.GAME.stake > 1 and {"
position = "before"
payload = '''
        {
            label = localize('b_gems'),
            tab_definition_function = G.UIDEF.used_gems,
        },
'''
match_indent = true

[[patches]]
[patches.pattern]
target = 'functions/UI_definitions.lua'
pattern = '''
          card.children.buy_button = UIBox{
            definition = t2,
            config = {
              align="bm",
              offset = {x=0,y=-0.3},
              major = card,
              bond = 'Weak',
              parent = card
            }
          }
'''
position = "at"
payload = '''
if card.ability.set ~= "Gem" then
	card.children.buy_button = UIBox{
            definition = t2,
            config = {
              align="bm",
              offset = {x=0,y=-0.3},
              major = card,
              bond = 'Weak',
              parent = card
            }
          }
		end
'''
match_indent = true


